import{aA as H}from"./index--qnl42Sc.js";function P(i,u){let t;try{t=i()}catch{return}return{getItem:s=>{var r;const a=d=>d===null?null:JSON.parse(d,void 0),m=(r=t.getItem(s))!=null?r:null;return m instanceof Promise?m.then(a):a(m)},setItem:(s,r)=>t.setItem(s,JSON.stringify(r,void 0)),removeItem:s=>t.removeItem(s)}}const I=i=>u=>{try{const t=i(u);return t instanceof Promise?t:{then(e){return I(e)(t)},catch(e){return this}}}catch(t){return{then(e){return this},catch(e){return I(e)(t)}}}},R=(i,u)=>(t,e,s)=>{let r={storage:P(()=>localStorage),partialize:n=>n,version:0,merge:(n,v)=>({...v,...n}),...u},a=!1;const m=new Set,d=new Set;let l=r.storage;if(!l)return i((...n)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...n)},e,s);const g=()=>{const n=r.partialize({...e()});return l.setItem(r.name,{state:n,version:r.version})},_=s.setState;s.setState=(n,v)=>(_(n,v),g());const h=i((...n)=>(t(...n),g()),e,s);s.getInitialState=()=>h;let f;const S=()=>{var n,v;if(!l)return;a=!1,m.forEach(o=>{var c;return o((c=e())!=null?c:h)});const p=((v=r.onRehydrateStorage)==null?void 0:v.call(r,(n=e())!=null?n:h))||void 0;return I(l.getItem.bind(l))(r.name).then(o=>{if(o)if(typeof o.version=="number"&&o.version!==r.version){if(r.migrate){const c=r.migrate(o.state,o.version);return c instanceof Promise?c.then(y=>[!0,y]):[!0,c]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,o.state];return[!1,void 0]}).then(o=>{var c;const[y,b]=o;if(f=r.merge(b,(c=e())!=null?c:h),t(f,!0),y)return g()}).then(()=>{p?.(f,void 0),f=e(),a=!0,d.forEach(o=>o(f))}).catch(o=>{p?.(void 0,o)})};return s.persist={setOptions:n=>{r={...r,...n},n.storage&&(l=n.storage)},clearStorage:()=>{l?.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>S(),hasHydrated:()=>a,onHydrate:n=>(m.add(n),()=>{m.delete(n)}),onFinishHydration:n=>(d.add(n),()=>{d.delete(n)})},r.skipHydration||S(),f||h},w=R,F=H()(w((i,u)=>({items:[],addItem:(t,e=1)=>{const s=u().items,r=s.find(a=>a.product._id===t._id);i(r?{items:s.map(a=>a.product._id===t._id?{...a,quantity:a.quantity+e}:a)}:{items:[...s,{product:t,quantity:e}]})},removeItem:t=>{i({items:u().items.filter(e=>e.product._id!==t)})},updateQuantity:(t,e)=>{if(e<=0){u().removeItem(t);return}i({items:u().items.map(s=>s.product._id===t?{...s,quantity:e}:s)})},clearCart:()=>i({items:[]}),getTotalItems:()=>u().items.reduce((t,e)=>t+e.quantity,0),getTotalPrice:()=>u().items.reduce((t,e)=>t+e.product.price*e.quantity,0)}),{name:"cart-storage"}));export{F as u};
